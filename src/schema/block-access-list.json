{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://ethereum.org/schemas/bal/block-access-list.json",
  "title": "Block Access List (BAL)",
  "description": "Ethereum Block Access List specification for EIP-7928. Contains all account changes including storage accesses, balance changes, code deployments, and nonce values for efficient state transition verification.",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "account_changes"
  ],
  "properties": {
    "account_changes": {
      "title": "Account Changes",
      "description": "All changes for each account including storage, balance, nonce, and code changes.",
      "type": "array",
      "maxItems": 300000,
      "items": {
        "$ref": "#/$defs/AccountChanges"
      }
    }
  },
  "$defs": {
    "Address": {
      "title": "Ethereum Address",
      "description": "20-byte Ethereum address in hexadecimal format",
      "type": "string",
      "pattern": "^0x[a-fA-F0-9]{40}$",
      "examples": ["0x1234567890abcdef1234567890abcdef12345678"]
    },
    "StorageKey": {
      "title": "Storage Key",
      "description": "32-byte storage slot identifier in hexadecimal format",
      "type": "string",
      "pattern": "^0x[a-fA-F0-9]{64}$",
      "examples": [
        "0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef"
      ]
    },
    "StorageValue": {
      "title": "Storage Value",
      "description": "32-byte storage value in hexadecimal format",
      "type": "string",
      "pattern": "^0x[a-fA-F0-9]{64}$",
      "examples": [
        "0x0000000000000000000000000000000000000000000000000000000000000020"
      ]
    },
    "Balance": {
      "title": "Balance",
      "description": "16-byte balance value in hexadecimal format",
      "type": "string",
      "pattern": "^0x[a-fA-F0-9]{32}$",
      "examples": ["0x0de0b6b3a7640000000000000000000"]
    },
    "TxIndex": {
      "title": "Transaction Index",
      "description": "Zero-based index of transaction within the block",
      "type": "integer",
      "minimum": 0,
      "maximum": 29999
    },
    "Nonce": {
      "title": "Account Nonce",
      "description": "Account nonce value (uint64)",
      "type": "integer",
      "minimum": 0,
      "maximum": 18446744073709551615
    },
    "CodeData": {
      "title": "Contract Bytecode",
      "description": "Contract bytecode in hexadecimal format. Maximum size enforced by EIP-170.",
      "type": "string",
      "pattern": "^0x([a-fA-F0-9]{2})*$",
      "maxLength": 49154,
      "examples": ["0x608060405234801561001057600080fd5b50"]
    },
    "StorageChange": {
      "title": "Storage Change",
      "description": "Storage change for a specific transaction",
      "type": "object",
      "additionalProperties": false,
      "required": ["tx_index", "new_value"],
      "properties": {
        "tx_index": {
          "$ref": "#/$defs/TxIndex",
          "description": "Transaction index that changed this storage slot"
        },
        "new_value": {
          "$ref": "#/$defs/StorageValue",
          "description": "New storage value after this transaction"
        }
      }
    },
    "SlotChanges": {
      "title": "Storage Slot Changes",
      "description": "Changes to a single storage slot across multiple transactions",
      "type": "object",
      "additionalProperties": false,
      "required": ["slot", "changes"],
      "properties": {
        "slot": {
          "$ref": "#/$defs/StorageKey",
          "description": "Storage slot identifier"
        },
        "changes": {
          "description": "List of changes to this slot",
          "type": "array",
          "maxItems": 30000,
          "items": {
            "$ref": "#/$defs/StorageChange"
          }
        }
      }
    },
    "BalanceChange": {
      "title": "Balance Change",
      "description": "Balance change for a specific transaction",
      "type": "object",
      "additionalProperties": false,
      "required": ["tx_index", "post_balance"],
      "properties": {
        "tx_index": {
          "$ref": "#/$defs/TxIndex",
          "description": "Transaction index that caused this balance change"
        },
        "post_balance": {
          "$ref": "#/$defs/Balance",
          "description": "Balance after this transaction"
        }
      }
    },
    "NonceChange": {
      "title": "Nonce Change",
      "description": "Nonce change for a specific transaction",
      "type": "object",
      "additionalProperties": false,
      "required": ["tx_index", "new_nonce"],
      "properties": {
        "tx_index": {
          "$ref": "#/$defs/TxIndex",
          "description": "Transaction index that changed this nonce"
        },
        "new_nonce": {
          "$ref": "#/$defs/Nonce",
          "description": "New nonce value after this transaction"
        }
      }
    },
    "CodeChange": {
      "title": "Code Change",
      "description": "Code change for a specific transaction",
      "type": "object",
      "additionalProperties": false,
      "required": ["tx_index", "new_code"],
      "properties": {
        "tx_index": {
          "$ref": "#/$defs/TxIndex",
          "description": "Transaction index that deployed this code"
        },
        "new_code": {
          "$ref": "#/$defs/CodeData",
          "description": "Deployed contract bytecode"
        }
      }
    },
    "AccountChanges": {
      "title": "Account Changes",
      "description": "All changes for a single account within the block",
      "type": "object",
      "additionalProperties": false,
      "required": ["address"],
      "properties": {
        "address": {
          "$ref": "#/$defs/Address",
          "description": "Account address"
        },
        "storage_changes": {
          "description": "Storage slot changes for this account",
          "type": "array",
          "maxItems": 300000,
          "items": {
            "$ref": "#/$defs/SlotChanges"
          },
          "default": []
        },
        "storage_reads": {
          "description": "Storage slots that were read but not modified",
          "type": "array",
          "maxItems": 300000,
          "items": {
            "$ref": "#/$defs/StorageKey"
          },
          "default": []
        },
        "balance_changes": {
          "description": "Balance changes for this account",
          "type": "array",
          "maxItems": 30000,
          "items": {
            "$ref": "#/$defs/BalanceChange"
          },
          "default": []
        },
        "nonce_changes": {
          "description": "Nonce changes for this account",
          "type": "array",
          "maxItems": 30000,
          "items": {
            "$ref": "#/$defs/NonceChange"
          },
          "default": []
        },
        "code_changes": {
          "description": "Code changes for this account",
          "type": "array",
          "maxItems": 1,
          "items": {
            "$ref": "#/$defs/CodeChange"
          },
          "default": []
        }
      }
    }
  },
  "examples": [
    {
      "title": "Simple Account Changes",
      "description": "Basic example showing account changes across transactions",
      "account_changes": [
        {
          "address": "0x1234567890abcdef1234567890abcdef12345678",
          "storage_changes": [
            {
              "slot": "0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef",
              "changes": [
                {
                  "tx_index": 0,
                  "new_value": "0x0000000000000000000000000000000000000000000000000000000000000020"
                },
                {
                  "tx_index": 1,
                  "new_value": "0x0000000000000000000000000000000000000000000000000000000000000030"
                }
              ]
            }
          ],
          "storage_reads": [],
          "balance_changes": [
            {
              "tx_index": 0,
              "post_balance": "0x0de0b6b3a7640000000000000000000"
            }
          ],
          "nonce_changes": [
            {
              "tx_index": 0,
              "new_nonce": 42
            }
          ],
          "code_changes": []
        }
      ]
    }
  ],
  "x-constants": {
    "MAX_CODE_SIZE": {
      "value": 24576,
      "description": "Maximum contract bytecode size in bytes (EIP-170)",
      "source": "basic.py"
    },
    "MAX_TXS": {
      "value": 30000,
      "description": "Maximum number of transactions per block",
      "source": "basic.py"
    },
    "MAX_ACCOUNTS": {
      "value": 300000,
      "description": "Maximum number of accounts in access lists",
      "source": "basic.py"
    },
    "MAX_SLOTS": {
      "value": 300000,
      "description": "Maximum number of storage slots per account",
      "source": "basic.py"
    },
    "MAX_CODE_CHANGES": {
      "value": 1,
      "description": "Maximum number of code changes per account (only one deployment per account per block)",
      "source": "basic.py"
    }
  },
  "x-implementation-notes": {
    "BalanceDelta": "Uses 12-byte two's complement to handle negative balances and full ETH supply range while being more compact than uint256",
    "tx_index": "Zero-based indexing correlates access patterns with specific transactions for replay and verification",
    "value_after": "Stores the result value that subsequent transactions would read, enabling parallel execution optimization",
    "SSZ encoding": "All data structures use SSZ encoding as specified in the Ethereum consensus specification"
  }
}
